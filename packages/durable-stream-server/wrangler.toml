name = "durable-streams"
main = "src/worker.ts"
compatibility_date = "2026-02-02"

# Serve admin UI static assets
# Note: Build the admin-ui first with `pnpm run build:admin-ui`
# Assets are served at /admin/* (based on the base path in vite.config.ts)
[assets]
directory = "dist/admin-ui"
binding = "ASSETS"

[durable_objects]
bindings = [
  { name = "STREAMS", class_name = "StreamDO" }
]

[[migrations]]
tag = "v1"
new_sqlite_classes = ["StreamDO"]

[[d1_databases]]
binding = "ADMIN_DB"
database_name = "durable-streams"
database_id = "c0ff514c-c85f-4296-8429-23453105648a"

[[r2_buckets]]
binding = "R2"
bucket_name = "durable-streams"

[[queues.producers]]
binding = "FANOUT_QUEUE"
queue = "durable-streams-fanout-queue"

[[queues.consumers]]
queue = "durable-streams-fanout-queue"
max_batch_size = 100
max_batch_timeout = 30

[[analytics_engine_datasets]]
binding = "METRICS"
dataset = "durable_streams_metrics"

[vars]
# Optional: set to require auth
# AUTH_TOKEN = "replace-with-token"
# Optional: set cache mode explicitly: "shared" or "private"
# CACHE_MODE = "shared"
# SEGMENT_MAX_MESSAGES = "1000"
# SEGMENT_MAX_BYTES = "4194304"

[observability]
enabled = true
