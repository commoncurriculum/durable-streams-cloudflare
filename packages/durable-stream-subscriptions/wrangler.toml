name = "durable-stream-subscriptions"
main = "src/worker.ts"
compatibility_date = "2024-01-01"

[vars]
CORE_URL = "http://localhost:8787"
SESSION_TTL_SECONDS = "1800"
# Required for Analytics Engine SQL queries (cleanup)
# ACCOUNT_ID = "<your-cloudflare-account-id>"
# API_TOKEN should be set via: npx wrangler secret put API_TOKEN
ANALYTICS_DATASET = "subscriptions_metrics"

# Durable Objects for per-stream subscriber storage
[durable_objects]
bindings = [
  { name = "SUBSCRIPTION_DO", class_name = "SubscriptionDO" }
]

[[migrations]]
tag = "v1"
new_sqlite_classes = ["SubscriptionDO"]

# Analytics Engine for observability metrics
[[analytics_engine_datasets]]
binding = "METRICS"
dataset = "subscriptions_metrics"

# Service binding to core worker (recommended for production)
# [[services]]
# binding = "CORE"
# service = "durable-streams"

# Session cleanup cron
[triggers]
crons = ["*/5 * * * *"]
