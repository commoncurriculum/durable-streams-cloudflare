name = "durable-streams-subscriptions-test"
main = "test/integration/test-worker.ts"
compatibility_date = "2026-02-02"
compatibility_flags = []

[vars]
ESTUARY_TTL_SECONDS = "1800"

# Durable Objects for per-stream subscriber storage and per-estuary subscription tracking
[durable_objects]
bindings = [
  { name = "SUBSCRIPTION_DO", class_name = "SubscriptionDO" },
  { name = "ESTUARY_DO", class_name = "EstuaryDO" },
]

[[migrations]]
tag = "v1"
new_sqlite_classes = ["SubscriptionDO"]

[[migrations]]
tag = "v2"
new_sqlite_classes = ["EstuaryDO"]

# Analytics Engine for observability metrics
[[analytics_engine_datasets]]
binding = "METRICS"
dataset = "subscriptions_metrics"

# KV namespace for per-project signing secrets
[[kv_namespaces]]
binding = "REGISTRY"
id = "registry"

# Service binding to core worker (required)
[[services]]
binding = "CORE"
service = "durable-streams"
