name = "durable-streams-subscriptions-test"
main = "test/integration/test-worker.ts"
compatibility_date = "2026-02-02"
compatibility_flags = []

[vars]
SESSION_TTL_SECONDS = "1800"
ANALYTICS_DATASET = "subscriptions_metrics"

# Durable Objects for per-stream subscriber storage and per-session subscription tracking
[durable_objects]
bindings = [
  { name = "SUBSCRIPTION_DO", class_name = "SubscriptionDO" },
  { name = "SESSION_DO", class_name = "SessionDO" },
]

[[migrations]]
tag = "v1"
new_sqlite_classes = ["SubscriptionDO"]

[[migrations]]
tag = "v2"
new_sqlite_classes = ["SessionDO"]

# Analytics Engine for observability metrics
[[analytics_engine_datasets]]
binding = "METRICS"
dataset = "subscriptions_metrics"

# KV namespace for per-project signing secrets
[[kv_namespaces]]
binding = "REGISTRY"
id = "project-keys"

# Service binding to core worker (required)
[[services]]
binding = "CORE"
service = "durable-streams"

# Session cleanup cron
[triggers]
crons = ["*/5 * * * *"]
